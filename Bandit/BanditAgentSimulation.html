<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bayesian Pricing Bandit + Gemini AI</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Prop Types (Required for Recharts) -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { background-color: #0f172a; color: white; font-family: 'Inter', sans-serif; }
        .curve-container { transition: all 0.5s ease; }
        .sparkle-btn {
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            background-size: 200% 200%;
            animation: gradient 3s ease infinite;
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, ReferenceLine } = Recharts;

        // --- INLINE ICONS (Replaces Lucide-React to fix load errors) ---
        const IconBase = ({ children, size = 24, className = "" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        const Icons = {
            Play: (props) => <IconBase {...props}><polygon points="5 3 19 12 5 21 5 3" /></IconBase>,
            Pause: (props) => <IconBase {...props}><rect x="6" y="4" width="4" height="16" /><rect x="14" y="4" width="4" height="16" /></IconBase>,
            RotateCcw: (props) => <IconBase {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12" /><path d="M3 5v7h7" /></IconBase>,
            Brain: (props) => <IconBase {...props}><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z" /><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z" /></IconBase>,
            User: (props) => <IconBase {...props}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></IconBase>,
            ShoppingCart: (props) => <IconBase {...props}><circle cx="9" cy="21" r="1" /><circle cx="20" cy="21" r="1" /><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6" /></IconBase>,
            XCircle: (props) => <IconBase {...props}><circle cx="12" cy="12" r="10" /><path d="m15 9-6 6" /><path d="m9 9 6 6" /></IconBase>,
            TrendingUp: (props) => <IconBase {...props}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" /></IconBase>,
            Sparkles: (props) => <IconBase {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275Z" /></IconBase>,
            Zap: (props) => <IconBase {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" /></IconBase>
        };

        const { Play, Pause, RotateCcw, Brain, User, ShoppingCart, XCircle, TrendingUp, Sparkles, Zap } = Icons;

        // --- GEMINI API HELPERS ---
        const API_KEY = "AIzaSyDTTUg9UzMvgrBm1AU2V_SXHmPjjrLpJ9M"; // System will inject key at runtime

        async function callGeminiText(prompt) {
            if (!API_KEY) {
                 // Fallback if no key provided in environment (simulated response)
                 return new Promise(resolve => setTimeout(() => resolve("Note: API Key missing. Simulated Analysis: The agent seems to be converging on the $40 price point. The variance on $70 is still high, suggesting it needs more exploration."), 1000));
            }
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`;
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "Error analyzing strategy.";
            } catch (e) {
                console.error(e);
                return "Error connecting to AI Consultant.";
            }
        }

        async function callGeminiJSON(prompt) {
            if (!API_KEY) {
                // Fallback simulation
                return new Promise(resolve => setTimeout(() => resolve({
                    headline: "Simulated: Competitor Bankruptcy",
                    description: "A major competitor folded, driving up demand for your product.",
                    true_value_change: 10,
                    cost_change: 0
                }), 1000));
            }
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`;
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });
                const data = await response.json();
                return JSON.parse(data.candidates?.[0]?.content?.parts?.[0]?.text);
            } catch (e) {
                console.error(e);
                return null;
            }
        }

        // --- MATH HELPERS ---
        function generateGamma(alpha) {
            if (alpha < 1) return generateGamma(1 + alpha) * Math.pow(Math.random(), 1 / alpha);
            const d = alpha - 1 / 3;
            const c = 1 / Math.sqrt(9 * d);
            while (true) {
                const x = boxMuller();
                const v = 1 + c * x;
                if (v <= 0) continue;
                const v3 = v * v * v;
                const u = Math.random();
                if (u < 1 - 0.0331 * x * x * x * x) return d * v3;
                if (Math.log(u) < 0.5 * x * x + d * (1 - v3 + Math.log(v3))) return d * v3;
            }
        }
        
        function boxMuller() {
            let u = 0, v = 0;
            while(u === 0) u = Math.random(); 
            while(v === 0) v = Math.random();
            return Math.sqrt( -2.0 * Math.log( u ) ) * Math.cos( 2.0 * Math.PI * v );
        }

        function sampleBeta(alpha, beta) {
            const x = generateGamma(alpha);
            const y = generateGamma(beta);
            return x / (x + y);
        }

        function betaPDF(x, alpha, beta) {
            if (x === 0 || x === 1) return 0;
            return Math.pow(x, alpha - 1) * Math.pow(1 - x, beta - 1);
        }

        // --- CONSTANTS ---
        const PRICES = [30, 40, 50, 60, 70];
        const COLORS = ["#3b82f6", "#10b981", "#f59e0b", "#ef4444", "#8b5cf6"];
        
        // --- COMPONENT ---
        const App = () => {
            // Config
            const [trueValue, setTrueValue] = useState(45);
            const [productCost, setProductCost] = useState(30);
            const [sensitivity, setSensitivity] = useState(0.2);
            const [speed, setSpeed] = useState(1000); 
            
            // Simulation State
            const [isPlaying, setIsPlaying] = useState(false);
            const [alphas, setAlphas] = useState(PRICES.map(() => 1));
            const [betas, setBetas] = useState(PRICES.map(() => 1));
            const [history, setHistory] = useState([]);
            const [totalProfit, setTotalProfit] = useState(0);
            const [day, setDay] = useState(0);

            // Animation State
            const [currentAction, setCurrentAction] = useState(null); 
            const timerRef = useRef(null);

            // AI State
            const [analysis, setAnalysis] = useState("");
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [marketEvent, setMarketEvent] = useState(null);
            const [isGeneratingEvent, setIsGeneratingEvent] = useState(false);

            // --- AI ACTIONS ---
            const analyzeStrategy = async () => {
                setIsPlaying(false); // Pause simulation
                setIsAnalyzing(true);
                setAnalysis("");

                const prompt = `
                    You are a Senior Data Scientist analyzing a Multi-Armed Bandit algorithm for Dynamic Pricing.
                    
                    CURRENT SIMULATION STATE:
                    - Available Prices: ${JSON.stringify(PRICES)}
                    - Alphas (Sales count + 1): ${JSON.stringify(alphas)}
                    - Betas (No-Sales count + 1): ${JSON.stringify(betas)}
                    - Total Days Run: ${day}
                    - Total Profit: $${totalProfit}
                    - Current True Customer Value (Hidden from agent): $${trueValue}
                    - Current Product Cost: $${productCost}

                    TASK:
                    1. Identify which price the Agent currently "thinks" is best (highest probability mass).
                    2. Determine if the Agent is still exploring (wide variance/low alpha+beta) or exploiting.
                    3. Compare the Agent's choice to the "Hidden True Value" (Is it underpricing or overpricing?).
                    4. Give a 1-sentence strategic tip to the user.

                    Keep response concise (max 3 sentences) and professional. Use emojis.
                `;

                const result = await callGeminiText(prompt);
                setAnalysis(result);
                setIsAnalyzing(false);
            };

            const triggerMarketShock = async () => {
                setIsGeneratingEvent(true);
                
                const prompt = `
                    Generate a random, realistic "Market Shock" event for a retail product pricing simulation.
                    Examples: "Supply Chain Crisis", "Viral TikTok Trend", "Competitor Bankruptcy", "Inflation Spike".
                    
                    Return ONLY a JSON object with this schema:
                    {
                        "headline": "string (Short Title)",
                        "description": "string (1 sentence description)",
                        "true_value_change": integer (between -15 and +15),
                        "cost_change": integer (between -10 and +10)
                    }
                `;

                const eventData = await callGeminiJSON(prompt);
                
                if (eventData) {
                    setMarketEvent(eventData);
                    // Apply changes
                    setTrueValue(prev => Math.min(80, Math.max(30, prev + eventData.true_value_change)));
                    setProductCost(prev => Math.min(60, Math.max(10, prev + eventData.cost_change)));
                    
                    // Clear event msg after 8 seconds
                    setTimeout(() => setMarketEvent(null), 8000);
                }
                setIsGeneratingEvent(false);
            };

            // --- THE LOGIC STEP ---
            const step = () => {
                let bestIdx = -1;
                let maxProfit = -Infinity;
                const samples = [];

                PRICES.forEach((price, idx) => {
                    const prob = sampleBeta(alphas[idx], betas[idx]);
                    const margin = price - productCost;
                    const expectedProfit = prob * margin;
                    samples.push({ prob, expectedProfit });

                    if (expectedProfit > maxProfit) {
                        maxProfit = expectedProfit;
                        bestIdx = idx;
                    }
                });

                const chosenPrice = PRICES[bestIdx];
                const trueProb = 1 / (1 + Math.exp(sensitivity * (chosenPrice - trueValue)));
                const sale = Math.random() < trueProb;

                setCurrentAction({
                    bestIdx,
                    price: chosenPrice,
                    samples,
                    sale,
                    profit: sale ? (chosenPrice - productCost) : 0
                });

                setAlphas(prev => {
                    const next = [...prev];
                    if (sale) next[bestIdx] += 1;
                    return next;
                });
                setBetas(prev => {
                    const next = [...prev];
                    if (!sale) next[bestIdx] += 1;
                    return next;
                });

                setTotalProfit(prev => prev + (sale ? (chosenPrice - productCost) : 0));
                setDay(d => d + 1);
                
                setHistory(prev => {
                    const newEntry = { day: prev.length + 1, price: chosenPrice, outcome: sale ? 1 : 0 };
                    return [...prev.slice(-49), newEntry]; 
                });
            };

            useEffect(() => {
                if (isPlaying) {
                    timerRef.current = setInterval(step, speed);
                } else {
                    clearInterval(timerRef.current);
                }
                return () => clearInterval(timerRef.current);
            }, [isPlaying, alphas, betas, speed, trueValue, productCost]); 

            const reset = () => {
                setIsPlaying(false);
                setAlphas(PRICES.map(() => 1));
                setBetas(PRICES.map(() => 1));
                setHistory([]);
                setTotalProfit(0);
                setDay(0);
                setCurrentAction(null);
                setAnalysis("");
                setMarketEvent(null);
            };

            const curveData = useMemo(() => {
                const data = [];
                for (let i = 0; i <= 100; i++) {
                    const x = i / 100;
                    const point = { x };
                    PRICES.forEach((p, idx) => {
                        let y = betaPDF(x, alphas[idx], betas[idx]);
                        if (y > 20) y = 20; 
                        point[`price_${p}`] = y;
                    });
                    data.push(point);
                }
                return data;
            }, [alphas, betas]);

            return (
                <div className="min-h-screen bg-slate-900 p-4 md:p-8 max-w-6xl mx-auto flex flex-col gap-6">
                    
                    {/* HEADER */}
                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center bg-slate-800 p-6 rounded-xl border border-slate-700 shadow-xl relative overflow-hidden">
                        <div className="z-10">
                            <h1 className="text-2xl font-bold text-blue-400 flex items-center gap-2">
                                <Brain className="w-8 h-8" />
                                Bandit Pricing Simulator
                            </h1>
                            <p className="text-slate-400 text-sm mt-1">Bayesian Reinforcement Learning in Action</p>
                        </div>
                        
                        {/* ANALYSIS BOX */}
                        <div className="mt-4 md:mt-0 md:ml-6 flex-1 max-w-xl">
                            {analysis ? (
                                <div className="bg-slate-700/50 p-3 rounded-lg border border-indigo-500/30 text-xs md:text-sm text-indigo-200 animate-in fade-in slide-in-from-bottom-2">
                                    <div className="flex justify-between items-start mb-1">
                                        <span className="font-bold flex items-center gap-1"><Sparkles size={12}/> AI Consultant</span>
                                        <button onClick={() => setAnalysis("")}><XCircle size={14} className="hover:text-white"/></button>
                                    </div>
                                    <p className="leading-relaxed">{analysis}</p>
                                </div>
                            ) : (
                                <button 
                                    onClick={analyzeStrategy}
                                    disabled={isAnalyzing}
                                    className="sparkle-btn text-white px-4 py-2 rounded-full font-bold text-sm shadow-lg hover:scale-105 transition flex items-center gap-2 disabled:opacity-50 disabled:scale-100"
                                >
                                    {isAnalyzing ? "Consulting AI..." : <>Analyze Strategy <Sparkles size={16}/></>}
                                </button>
                            )}
                        </div>

                        <div className="flex gap-4 mt-4 md:mt-0 z-10">
                            <div className="text-right">
                                <p className="text-xs text-slate-500 uppercase font-bold">Total Profit</p>
                                <p className={`text-2xl font-mono ${totalProfit >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                    ${totalProfit.toLocaleString()}
                                </p>
                            </div>
                            <div className="text-right border-l border-slate-700 pl-4">
                                <p className="text-xs text-slate-500 uppercase font-bold">Day</p>
                                <p className="text-2xl font-mono text-white">#{day}</p>
                            </div>
                        </div>
                    </div>

                    {/* MARKET EVENT BANNER */}
                    {marketEvent && (
                        <div className="bg-amber-900/40 border border-amber-600/50 p-4 rounded-xl flex items-center gap-4 animate-in slide-in-from-top-4 shadow-lg shadow-amber-900/20">
                            <div className="bg-amber-600 p-2 rounded-full text-white">
                                <Zap size={24} />
                            </div>
                            <div className="flex-1">
                                <h3 className="text-amber-400 font-bold text-lg">{marketEvent.headline}</h3>
                                <p className="text-amber-200 text-sm">{marketEvent.description}</p>
                                <div className="flex gap-4 mt-1 text-xs font-mono text-amber-300/80">
                                    <span>Values: {marketEvent.true_value_change > 0 ? '+' : ''}{marketEvent.true_value_change}</span>
                                    <span>Costs: {marketEvent.cost_change > 0 ? '+' : ''}{marketEvent.cost_change}</span>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        
                        {/* LEFT: CONTROLS & VISUALIZATION */}
                        <div className="lg:col-span-1 flex flex-col gap-6">
                            
                            {/* Controls */}
                            <div className="bg-slate-800 p-6 rounded-xl border border-slate-700">
                                <h3 className="text-sm font-bold text-slate-400 uppercase mb-4">God Mode Settings</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="flex justify-between text-xs mb-1">True Customer Value <span>${trueValue}</span></label>
                                        <input type="range" min="30" max="80" value={trueValue} onChange={(e) => setTrueValue(Number(e.target.value))} className="w-full accent-blue-500"/>
                                    </div>
                                    <div>
                                        <label className="flex justify-between text-xs mb-1">Product Cost <span>${productCost}</span></label>
                                        <input type="range" min="10" max="60" value={productCost} onChange={(e) => setProductCost(Number(e.target.value))} className="w-full accent-red-500"/>
                                    </div>
                                    <div>
                                        <label className="flex justify-between text-xs mb-1">Speed <span>{speed < 100 ? 'Hyper' : speed + 'ms'}</span></label>
                                        <input type="range" min="10" max="2000" step="10" value={2010 - speed} onChange={(e) => setSpeed(2010 - Number(e.target.value))} className="w-full accent-purple-500"/>
                                    </div>
                                </div>
                                
                                {/* TRIGGER SHOCK BUTTON */}
                                <div className="mt-4 pt-4 border-t border-slate-700">
                                    <button 
                                        onClick={triggerMarketShock}
                                        disabled={isGeneratingEvent}
                                        className="w-full bg-slate-700 hover:bg-slate-600 text-amber-400 py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition border border-slate-600 hover:border-amber-500/50"
                                    >
                                        {isGeneratingEvent ? "Generating Chaos..." : <><Zap size={14}/> Trigger AI Market Shock</>}
                                    </button>
                                </div>

                                <div className="flex gap-2 mt-6">
                                    {!isPlaying ? (
                                        <button onClick={() => setIsPlaying(true)} className="flex-1 bg-green-600 hover:bg-green-500 text-white py-2 rounded-lg flex items-center justify-center gap-2 font-bold transition">
                                            <Play size={18} /> Start
                                        </button>
                                    ) : (
                                        <button onClick={() => setIsPlaying(false)} className="flex-1 bg-yellow-600 hover:bg-yellow-500 text-white py-2 rounded-lg flex items-center justify-center gap-2 font-bold transition">
                                            <Pause size={18} /> Pause
                                        </button>
                                    )}
                                    <button onClick={reset} className="px-4 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition">
                                        <RotateCcw size={18} />
                                    </button>
                                </div>
                            </div>

                            {/* Live Action Card */}
                            <div className="bg-slate-800 p-6 rounded-xl border border-slate-700 flex-1 relative overflow-hidden">
                                <h3 className="text-sm font-bold text-slate-400 uppercase mb-6">Live Transaction</h3>
                                
                                {currentAction ? (
                                    <div className="flex flex-col items-center gap-6 animate-in fade-in duration-300">
                                        
                                        {/* Step 1: Brain */}
                                        <div className="w-full bg-slate-900/50 p-3 rounded border border-slate-700/50 text-center">
                                            <p className="text-xs text-slate-500 mb-1">Agent Thought Process</p>
                                            <div className="flex justify-between items-end h-16 gap-1">
                                                {currentAction.samples.map((s, i) => (
                                                    <div key={i} className="flex-1 flex flex-col items-center gap-1 group relative">
                                                        <div 
                                                            className={`w-full rounded-t transition-all duration-300 ${i === currentAction.bestIdx ? 'bg-blue-500' : 'bg-slate-700 opacity-40'}`}
                                                            style={{ height: `${Math.min(100, Math.max(5, s.expectedProfit * 4))}%` }}
                                                        ></div>
                                                        <span className="text-[10px] text-slate-400">${PRICES[i]}</span>
                                                        <div className="absolute -top-8 bg-black text-white text-[10px] p-1 rounded opacity-0 group-hover:opacity-100 whitespace-nowrap z-10">
                                                            Est. Profit: ${s.expectedProfit.toFixed(1)}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Step 2: Action */}
                                        <div className="flex items-center gap-4">
                                            <div className="w-12 h-12 rounded-full bg-blue-900 flex items-center justify-center border-2 border-blue-500 shadow-[0_0_15px_rgba(59,130,246,0.5)]">
                                                <Brain className="text-blue-200" size={24} />
                                            </div>
                                            <div className="h-0.5 w-12 bg-slate-600"></div>
                                            <div className="px-4 py-2 bg-slate-100 text-slate-900 rounded font-bold text-xl shadow-lg transform scale-110">
                                                ${currentAction.price}
                                            </div>
                                            <div className="h-0.5 w-12 bg-slate-600"></div>
                                            <div className={`w-12 h-12 rounded-full flex items-center justify-center border-2 transition-all duration-300 ${currentAction.sale ? 'bg-green-900 border-green-500 shadow-[0_0_15px_rgba(16,185,129,0.5)]' : 'bg-red-900 border-red-500'}`}>
                                                <User className={currentAction.sale ? 'text-green-200' : 'text-red-200'} size={24} />
                                            </div>
                                        </div>

                                        {/* Step 3: Result */}
                                        <div className={`px-4 py-2 rounded-full text-sm font-bold flex items-center gap-2 ${currentAction.sale ? 'bg-green-900/30 text-green-400 border border-green-900' : 'bg-red-900/30 text-red-400 border border-red-900'}`}>
                                            {currentAction.sale ? (
                                                <><ShoppingCart size={16} /> SALE! Profit: +${currentAction.profit}</>
                                            ) : (
                                                <><XCircle size={16} /> NO SALE (Too expensive)</>
                                            )}
                                        </div>

                                    </div>
                                ) : (
                                    <div className="h-48 flex items-center justify-center text-slate-600">
                                        <p>Press Start to Run Simulation</p>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* RIGHT: CHARTS */}
                        <div className="lg:col-span-2 flex flex-col gap-6">
                            
                            {/* Beta Distributions Chart */}
                            <div className="bg-slate-800 p-4 rounded-xl border border-slate-700 flex-1 min-h-[300px]">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-sm font-bold text-slate-400 uppercase flex items-center gap-2">
                                        <TrendingUp size={16}/> The AI's Brain (Belief Distributions)
                                    </h3>
                                    <div className="flex gap-2">
                                        {PRICES.map((p, i) => (
                                            <div key={p} className="flex items-center gap-1 text-[10px]">
                                                <span className="w-2 h-2 rounded-full" style={{backgroundColor: COLORS[i]}}></span>
                                                <span className="text-slate-400">${p}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div className="h-[250px] w-full">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <LineChart data={curveData} margin={{ top: 5, right: 20, bottom: 5, left: 0 }}>
                                            <CartesianGrid strokeDasharray="3 3" stroke="#334155" opacity={0.5} />
                                            <XAxis 
                                                dataKey="x" 
                                                tick={{fill: '#94a3b8', fontSize: 10}} 
                                                label={{ value: 'Conversion Probability', position: 'insideBottom', offset: -5, fill: '#64748b', fontSize: 12 }} 
                                            />
                                            <Tooltip 
                                                contentStyle={{backgroundColor: '#1e293b', border: '1px solid #334155'}} 
                                                itemStyle={{fontSize: '12px'}}
                                                labelStyle={{display: 'none'}}
                                            />
                                            {PRICES.map((p, i) => (
                                                <Line 
                                                    key={p}
                                                    type="monotone" 
                                                    dataKey={`price_${p}`} 
                                                    stroke={COLORS[i]} 
                                                    strokeWidth={2}
                                                    dot={false}
                                                    animationDuration={300}
                                                />
                                            ))}
                                        </LineChart>
                                    </ResponsiveContainer>
                                </div>
                                <p className="text-xs text-slate-500 mt-2 text-center">
                                    Tall peaks = High confidence. Right side = High conversion rate. Left side = Low conversion.
                                </p>
                            </div>

                            {/* Price History Chart */}
                            <div className="bg-slate-800 p-4 rounded-xl border border-slate-700 h-[250px]">
                                <h3 className="text-sm font-bold text-slate-400 uppercase mb-4">Pricing Strategy History</h3>
                                <ResponsiveContainer width="100%" height="100%">
                                    <LineChart data={history}>
                                        <CartesianGrid strokeDasharray="3 3" stroke="#334155" opacity={0.5} />
                                        <XAxis dataKey="day" hide />
                                        <YAxis domain={[25, 75]} tick={{fill: '#94a3b8'}} />
                                        <Tooltip 
                                            contentStyle={{backgroundColor: '#1e293b', border: '1px solid #334155'}}
                                        />
                                        <Line 
                                            type="stepAfter" 
                                            dataKey="price" 
                                            stroke="#60a5fa" 
                                            strokeWidth={2} 
                                            dot={(props) => {
                                                const { cx, cy, payload } = props;
                                                return (
                                                    <circle 
                                                        cx={cx} 
                                                        cy={cy} 
                                                        r={3} 
                                                        fill={payload.outcome ? "#4ade80" : "#f87171"} 
                                                        stroke="none"
                                                    />
                                                );
                                            }}
                                        />
                                        <ReferenceLine y={trueValue} stroke="#94a3b8" strokeDasharray="3 3" label={{ value: 'True Value', fill: '#94a3b8', fontSize: 10 }} />
                                    </LineChart>
                                </ResponsiveContainer>
                            </div>

                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>